<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>WT eDNA quantification</title>

<script src="07_23_19_WT_toto1_brms_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="07_23_19_WT_toto1_brms_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="07_23_19_WT_toto1_brms_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="07_23_19_WT_toto1_brms_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="07_23_19_WT_toto1_brms_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="07_23_19_WT_toto1_brms_files/navigation-1.1/tabsets.js"></script>
<script src="07_23_19_WT_toto1_brms_files/navigation-1.1/codefolding.js"></script>
<link href="07_23_19_WT_toto1_brms_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="07_23_19_WT_toto1_brms_files/highlightjs-9.12.0/highlight.js"></script>
<script src="07_23_19_WT_toto1_brms_files/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">WT eDNA quantification</h1>
<h3 class="subtitle">Bayesian parameter estimation with Brms</h3>
<h4 class="date">07_23_19</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#results">Results</a><ul>
<li><a href="#model-1-3-levels">Model 1: 3 Levels</a></li>
</ul></li>
<li><a href="#model-2-2-levels">Model 2: 2 Levels!</a><ul>
<li><a href="#model-3-no-hierarchy">Model 3: No hierarchy</a></li>
<li><a href="#comparing-hierarchy-vs.flat">Comparing Hierarchy vs. Flat</a></li>
</ul></li>
</ul>
</div>

<pre class="r"><code>library(tidyverse)
library(cowplot)
library(broom) 
library(modelr) 
library(viridis)
library(lubridate)
library(hms)
library(knitr)
library(kableExtra)
library(ggridges)
library(brms)
library(tidybayes)
library(mice)

knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE, echo = TRUE, message=FALSE, warning=FALSE, fig.align=&quot;center&quot;)


source(&quot;../../../../IDA/tools/plotting_tools.R&quot;)

theme_set(theme_1())</code></pre>
<div id="intro" class="section level1">
<h1>Intro</h1>
<p>This notebook performs bayesian parameter estimation using <code>brms</code> on data that I acquired and processed in <a href="https://scott-saunders.github.io/labwork/HPLC/07_23_19_Colonies/TOTO1_measurements/analysis/07_23_19_WT_toto1_measurements.html">this notebook</a>. Essentially I quantified extracellular DNA in WT <em>P. aeruginosa</em> colony biofilms using the dye TOTO-1. I measured the fluorescence in replicate suspensions of replicate colonies and then calculated DNA content with a calibration curve of TOTO with calf thymus DNA (in vitro).</p>
<p>This dataset is inherently hierarchical because we have one hyperparameter that we are interested in - the eDNA concentration in WT colony biofilms, with 6 biological replicates (separate colony biofilms), and each biological replicate was measured in technical triplicate. It is quite reasonable to think that variability occurs at each level, because the biofilm suspension is not very homogeneous (so each technical replicate probably varies), and naturally there’s biological variability as well.</p>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
<p>Let’s first take a look at the dataset:</p>
<pre class="r"><code>wt_preds &lt;- read_csv(&quot;07_23_19_wt_TOTO_calCurve_estimates.csv&quot;)

wt_preds %&gt;% kable() %&gt;% kable_styling(bootstrap_options = &quot;condensed&quot;) %&gt;% 
    scroll_box(width = &quot;100%&quot;, height = &quot;400px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 5px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Wavelength
</th>
<th style="text-align:left;">
Well
</th>
<th style="text-align:right;">
FluorInt
</th>
<th style="text-align:left;">
Condition
</th>
<th style="text-align:right;">
Colony_number
</th>
<th style="text-align:right;">
Replicate
</th>
<th style="text-align:right;">
pred
</th>
<th style="text-align:right;">
eDNA_ug_mL
</th>
<th style="text-align:right;">
eDNA_dsDNA_uM
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
A2
</td>
<td style="text-align:right;">
22868
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.5861354
</td>
<td style="text-align:right;">
84.593889
</td>
<td style="text-align:right;">
253.781666
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D1
</td>
<td style="text-align:right;">
217
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0197467
</td>
<td style="text-align:right;">
-1.053155
</td>
<td style="text-align:right;">
-3.159467
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D2
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0232206
</td>
<td style="text-align:right;">
-1.238432
</td>
<td style="text-align:right;">
-3.715297
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D3
</td>
<td style="text-align:right;">
157
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0240005
</td>
<td style="text-align:right;">
-1.280025
</td>
<td style="text-align:right;">
-3.840075
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D4
</td>
<td style="text-align:right;">
173
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0228661
</td>
<td style="text-align:right;">
-1.219526
</td>
<td style="text-align:right;">
-3.658580
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D5
</td>
<td style="text-align:right;">
159
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0238587
</td>
<td style="text-align:right;">
-1.272463
</td>
<td style="text-align:right;">
-3.817388
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
D6
</td>
<td style="text-align:right;">
152
</td>
<td style="text-align:left;">
noDye
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.0243550
</td>
<td style="text-align:right;">
-1.298931
</td>
<td style="text-align:right;">
-3.896793
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E1
</td>
<td style="text-align:right;">
10665
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7209825
</td>
<td style="text-align:right;">
38.452399
</td>
<td style="text-align:right;">
115.357197
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E2
</td>
<td style="text-align:right;">
9108
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.6105963
</td>
<td style="text-align:right;">
32.565134
</td>
<td style="text-align:right;">
97.695401
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E3
</td>
<td style="text-align:right;">
6415
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.4196713
</td>
<td style="text-align:right;">
22.382471
</td>
<td style="text-align:right;">
67.147414
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E4
</td>
<td style="text-align:right;">
7289
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.4816351
</td>
<td style="text-align:right;">
25.687205
</td>
<td style="text-align:right;">
77.061614
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E5
</td>
<td style="text-align:right;">
10798
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7304118
</td>
<td style="text-align:right;">
38.955293
</td>
<td style="text-align:right;">
116.865880
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
E6
</td>
<td style="text-align:right;">
6794
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.4465412
</td>
<td style="text-align:right;">
23.815531
</td>
<td style="text-align:right;">
71.446592
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F1
</td>
<td style="text-align:right;">
12517
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.8522832
</td>
<td style="text-align:right;">
45.455107
</td>
<td style="text-align:right;">
136.365320
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F2
</td>
<td style="text-align:right;">
6882
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.4527801
</td>
<td style="text-align:right;">
24.148273
</td>
<td style="text-align:right;">
72.444818
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F3
</td>
<td style="text-align:right;">
9006
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.6033648
</td>
<td style="text-align:right;">
32.179456
</td>
<td style="text-align:right;">
96.538366
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F4
</td>
<td style="text-align:right;">
6559
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.4298805
</td>
<td style="text-align:right;">
22.926958
</td>
<td style="text-align:right;">
68.780874
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F5
</td>
<td style="text-align:right;">
8397
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.5601887
</td>
<td style="text-align:right;">
29.876729
</td>
<td style="text-align:right;">
89.630188
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
F6
</td>
<td style="text-align:right;">
6527
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.4276118
</td>
<td style="text-align:right;">
22.805961
</td>
<td style="text-align:right;">
68.417883
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G1
</td>
<td style="text-align:right;">
13607
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.9295607
</td>
<td style="text-align:right;">
49.576571
</td>
<td style="text-align:right;">
148.729711
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G2
</td>
<td style="text-align:right;">
8622
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5761404
</td>
<td style="text-align:right;">
30.727490
</td>
<td style="text-align:right;">
92.182471
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G3
</td>
<td style="text-align:right;">
7151
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.4718513
</td>
<td style="text-align:right;">
25.165405
</td>
<td style="text-align:right;">
75.496214
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G4
</td>
<td style="text-align:right;">
8291
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5526736
</td>
<td style="text-align:right;">
29.475926
</td>
<td style="text-align:right;">
88.427779
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G5
</td>
<td style="text-align:right;">
7998
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5319009
</td>
<td style="text-align:right;">
28.368047
</td>
<td style="text-align:right;">
85.104140
</td>
</tr>
<tr>
<td style="text-align:right;">
535
</td>
<td style="text-align:left;">
G6
</td>
<td style="text-align:right;">
8059
</td>
<td style="text-align:left;">
TOTO
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5362256
</td>
<td style="text-align:right;">
28.598697
</td>
<td style="text-align:right;">
85.796092
</td>
</tr>
</tbody>
</table>
</div>
<p>So you can see that we have the raw data from the wells (from the platereader), as well as a prediction of the well concentration, and biofilm concentration in uM (eDNA_dsDNA_uM). Look back at the other notebook to see how this was done. Anyway, what we have is a dataset that looks like this:</p>
<pre class="r"><code>ggplot(wt_preds, aes(x = Colony_number, y = eDNA_dsDNA_uM, shape = Condition)) + 
    geom_point()</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You can see that the wells incubated with dye show an obvious signal. There is heterogeneity among the different colonies (biological replicates), and the technical replicates. Let’s see if we can use some hierarchical models to accurately calculate an estimate for the eDNA content of the “hyper-colony”!</p>
<div id="model-1-3-levels" class="section level2">
<h2>Model 1: 3 Levels</h2>
<p>Ok, so for this first model I wrote out the following in brms syntax: <code>eDNA_dsDNA_uM ~ 1 + (1 | Colony_number / Replicate)</code></p>
<p>You’ll see as we work through the other models, but briefly this means estimate the intercept (e.g. the value) for this eDNA variable (<code>eDNA_dsDNA_uM ~ 1</code>), but group this intercept into a two level hierarchy with colony and then replicate (<code>+ (1 | Colony_number / Replicate)</code>). You can see that we only have to set the prior for the intercept hyperparameter <span class="math inline">\(\text{Normal}(100, 30)\)</span>. This model takes a while to run, but we’ll cache the results in a file. With multiple levels of hierarchy it can also be hard to estimate, so I’ve ramped up the iterations to 10,000 and adapt delta to 0.95.</p>
<pre class="r"><code>wt_brm &lt;- brm(eDNA_dsDNA_uM ~ 1 + (1 | Colony_number/Replicate), 
    data = wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;), prior = prior(normal(100, 
        30), class = Intercept), sample_prior = T, chains = 4, 
    cores = 2, iter = 10000, control = list(adapt_delta = 0.95), 
    thin = 5, inits = &quot;random&quot;, file = &quot;wt_brm_model_3&quot;)


summary(wt_brm)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: eDNA_dsDNA_uM ~ 1 + (1 | Colony_number/Replicate) 
##    Data: wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;) (Number of observations: 18) 
## Samples: 4 chains, each with iter = 10000; warmup = 5000; thin = 5;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~Colony_number (Number of levels: 6) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)    20.49      8.68     6.45    41.55       3378 1.00
## 
## ~Colony_number:Replicate (Number of levels: 18) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)     9.89      5.74     0.53    21.82       1339 1.00
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    92.81      9.21    74.44   111.55       3680 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    11.08      5.37     2.05    22.10        861 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>With these settings it seems like we get nice convergence and reasonable parameter estimates. Here’s the chains and posteriors:</p>
<pre class="r"><code>plot(wt_brm, N = 4, ask = F)</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>All the chains seem to be well mixed. <code>b_Intercept</code> is the hyperparameter for the intercept and the posterior looks reasonably good. The sd and sigma variables have some weirder distributions, but I think that’s to be expected for this dataset with relatively few datapoints.</p>
<pre class="r"><code>prior_summary(wt_brm) %&gt;% kable() %&gt;% kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
prior
</th>
<th style="text-align:left;">
class
</th>
<th style="text-align:left;">
coef
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
resp
</th>
<th style="text-align:left;">
dpar
</th>
<th style="text-align:left;">
nlpar
</th>
<th style="text-align:left;">
bound
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
normal(100, 30)
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
student_t(3, 0, 19)
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Colony_number
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
Colony_number
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Colony_number:Replicate
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
Colony_number:Replicate
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
student_t(3, 0, 19)
</td>
<td style="text-align:left;">
sigma
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<p>Just for clarity, these were the prior distributions that brms assumed for this model. So you can see there’s the hyperprior I supplied, then it’s a little harder to undertand. There seems to be a std.dev prior from the hyperparameter, then at the colony level there’s a sd for the sd and the intercept and same thing for each replicate?</p>
<p>I still don’t fully understand what brms is doing here, but also notice that there’s a sigma at bottom. My understanding is that brms has assumed that this is a gaussian process and that sigma should connect any group level parameters to the actual datapoints. Therefore, I believe, this model actually has too many levels and that each datapoint is accidentally in its own group, which is not correct.</p>
<p>We’ll try a simpler version of this model next.</p>
<p>Here’s what the hierarchical estimates look like plotted:</p>
<pre class="r"><code># ggplot(data = posterior_samples(wt_brm)) +
# geom_density(aes(x = b_Intercept))

# as_tibble(coef(wt_brm)$Colony_number, rownames =
# &#39;Colony_number&#39;)


ggplot(wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;), aes(x = factor(Colony_number), 
    y = eDNA_dsDNA_uM)) + geom_hline(yintercept = as_tibble(fixef(wt_brm))$Estimate, 
    linetype = 2) + geom_hline(yintercept = as_tibble(fixef(wt_brm))$Q2.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm))$Q97.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_jitter(height = 0, width = 0.1, 
    shape = 21) + geom_pointrange(data = as_tibble(coef(wt_brm)$Colony_number, 
    rownames = &quot;Colony_number&quot;), aes(x = factor(Colony_number), 
    y = Estimate.Intercept, ymin = Q2.5.Intercept, ymax = Q97.5.Intercept))</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The point ranges are 95% CI for each colony, and the dotted lines are 95% CI for the hyperparameter.</p>
</div>
</div>
<div id="model-2-2-levels" class="section level1">
<h1>Model 2: 2 Levels!</h1>
<p>Ok, with my realization on the last model, I believe we can just rewrite this hierarchy in brms syntax as <code>eDNA_dsDNA_uM ~ 1 + (1 | Colony_number)</code>. Comparing with above you can see that we have now told brms to only group the intercept values by colony number. Since brms assumes this is a gaussian model, it should connect the group level estimates from each colony to the observed datapoints with a normal distribution parameterized by sigma (as seen in the prior summary above). Let’s see how it works!</p>
<pre class="r"><code>wt_brm_single_level &lt;- brm(eDNA_dsDNA_uM ~ 1 + (1 | Colony_number), 
    data = wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;), prior = prior(normal(100, 
        30), class = Intercept), sample_prior = T, chains = 4, 
    cores = 2, iter = 10000, control = list(adapt_delta = 0.95), 
    thin = 5, inits = &quot;random&quot;, file = &quot;wt_brm_single_level_1&quot;)

summary(wt_brm_single_level)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: eDNA_dsDNA_uM ~ 1 + (1 | Colony_number) 
##    Data: wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;) (Number of observations: 18) 
## Samples: 4 chains, each with iter = 10000; warmup = 5000; thin = 5;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~Colony_number (Number of levels: 6) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)    21.21      8.69     7.91    41.45       3039 1.00
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    92.34      9.27    73.56   111.27       3644 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    15.36      3.55    10.25    24.02       2799 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Again, the chains seem to have mixed well. Notice that we have a lot more effective samples and fewer parameter estimates now - this looks more correct.</p>
<pre class="r"><code>plot(wt_brm_single_level)</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /> Again the chains look well mixed, and now the sd and sigma posteriors actually look unimodal, which is better. Let’s look at the prior summary:</p>
<pre class="r"><code># coef(wt_brm_single_level)

prior_summary(wt_brm_single_level) %&gt;% kable() %&gt;% kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
prior
</th>
<th style="text-align:left;">
class
</th>
<th style="text-align:left;">
coef
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
resp
</th>
<th style="text-align:left;">
dpar
</th>
<th style="text-align:left;">
nlpar
</th>
<th style="text-align:left;">
bound
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
normal(100, 30)
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
student_t(3, 0, 19)
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Colony_number
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
Colony_number
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
student_t(3, 0, 19)
</td>
<td style="text-align:left;">
sigma
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<p>This looks more like what I would expect. I still need to understand exactly how brms is using the sd class priors though…</p>
<p>Anyway, let’s compare the prior and posterior for our hyperparameter:</p>
<pre class="r"><code>priorPostSamples &lt;- bind_rows(posterior_samples(wt_brm_single_level) %&gt;% 
    select(b_Intercept) %&gt;% mutate(dist = &quot;posterior&quot;), tibble(b_Intercept = rnorm(4000, 
    100, 30)) %&gt;% mutate(dist = &quot;prior&quot;))

ggplot(priorPostSamples, aes(x = b_Intercept, y = dist)) + geom_density_ridges(jittered_points = T, 
    position = &quot;raincloud&quot;, point_alpha = 0.02) + theme_ridges()</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Not bad! The data definitely informed the estimate, and the estimate seems reasonable based on the data. Let’s look at the group vs overall estimates:</p>
<pre class="r"><code>ggplot(wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;), aes(x = factor(Colony_number), 
    y = eDNA_dsDNA_uM)) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Estimate, 
    linetype = 2) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Q2.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Q97.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_jitter(height = 0, width = 0.1, 
    shape = 21) + geom_pointrange(data = as_tibble(coef(wt_brm_single_level)$Colony_number, 
    rownames = &quot;Colony_number&quot;), aes(x = factor(Colony_number), 
    y = Estimate.Intercept, ymin = Q2.5.Intercept, ymax = Q97.5.Intercept))</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You can see that for colonies 1 and 5 the confidence interval is pulling toward the overall estimate. The effects of the hierarchy aren’t super dramatic, but I think this makes a lot of sense. Just to fully vizualize the effects of the hierarchy, why don’t we compare to a model with no hierarchy!?</p>
<div id="model-3-no-hierarchy" class="section level2">
<h2>Model 3: No hierarchy</h2>
<p>Here the model is simply <code>eDNA_dsDNA_uM ~ 1</code>:</p>
<pre class="r"><code>wt_brm_no_level &lt;- brm(eDNA_dsDNA_uM ~ 1, data = wt_preds %&gt;% 
    filter(Condition == &quot;TOTO&quot;), prior = prior(normal(100, 30), 
    class = Intercept), sample_prior = T, chains = 4, cores = 2, 
    iter = 10000, control = list(adapt_delta = 0.95), thin = 5, 
    inits = &quot;random&quot;, file = &quot;wt_brm_no_level_1&quot;)

summary(wt_brm_no_level)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: eDNA_dsDNA_uM ~ 1 
##    Data: wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;) (Number of observations: 18) 
## Samples: 4 chains, each with iter = 10000; warmup = 5000; thin = 5;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    92.12      5.64    81.24   103.15       3832 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    24.37      4.37    17.55    34.42       3944 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The sampling seems to have gone well and the CI looks tighter.</p>
<pre class="r"><code>no_one_level_Samples &lt;- bind_rows(posterior_samples(wt_brm_single_level) %&gt;% 
    select(b_Intercept) %&gt;% mutate(dist = &quot;two level&quot;), posterior_samples(wt_brm_no_level) %&gt;% 
    select(b_Intercept) %&gt;% mutate(dist = &quot;no hier&quot;), tibble(b_Intercept = rnorm(4000, 
    100, 30)) %&gt;% mutate(dist = &quot;prior&quot;))

ggplot(no_one_level_Samples, aes(x = b_Intercept, y = dist)) + 
    geom_density_ridges(jittered_points = T, position = &quot;raincloud&quot;, 
        point_alpha = 0.02) + theme_ridges()</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Indeed, we can see that no hierarchy model is actually more confident in a tighter region than the hierarchy - why might that be?</p>
<p>Let’s fit models for each group individually (no hierarchy, but no pooling). These models get fit in parallel as a list, so it’s hard to show the output. I’ll just show the parameter estimate from colony 1 to convince you it worked:</p>
<pre class="r"><code>wt_preds_list &lt;- wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;) %&gt;% 
    group_split(Colony_number)

wt_brm_multi_flat &lt;- brm_multiple(eDNA_dsDNA_uM ~ 1, data = wt_preds_list, 
    prior = prior(normal(100, 30), class = Intercept), sample_prior = T, 
    chains = 4, cores = 2, iter = 4000, control = list(adapt_delta = 0.95), 
    inits = &quot;random&quot;, combine = F)

as_tibble(fixef(wt_brm_multi_flat[[1]]))</code></pre>
<pre><code>## # A tibble: 1 x 4
##   Estimate Est.Error  Q2.5 Q97.5
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     129.      11.7  102.  150.</code></pre>
</div>
<div id="comparing-hierarchy-vs.flat" class="section level2">
<h2>Comparing Hierarchy vs. Flat</h2>
<p>Now let’s do something cool Let’s overlay the 2 level hierarchical estimates with the no hierarchy pooled and unpooled estimates to vizualize the effect of the hierarchy:</p>
<pre class="r"><code>wt_no_level_coef &lt;- bind_rows(as_tibble(fixef(wt_brm_multi_flat[[1]])), 
    as_tibble(fixef(wt_brm_multi_flat[[2]]), ), as_tibble(fixef(wt_brm_multi_flat[[3]])), 
    as_tibble(fixef(wt_brm_multi_flat[[4]])), as_tibble(fixef(wt_brm_multi_flat[[5]])), 
    as_tibble(fixef(wt_brm_multi_flat[[6]]))) %&gt;% mutate(Colony_number = 1:6)

ggplot(wt_preds %&gt;% filter(Condition == &quot;TOTO&quot;), aes(x = factor(Colony_number), 
    y = eDNA_dsDNA_uM)) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Estimate, 
    linetype = 2) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Q2.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm_single_level))$Q97.5, 
    linetype = 2, color = &quot;gray&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm_no_level))$Estimate, 
    linetype = 2, color = &quot;red&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm_no_level))$Q2.5, 
    linetype = 2, color = &quot;red&quot;) + geom_hline(yintercept = as_tibble(fixef(wt_brm_no_level))$Q97.5, 
    linetype = 2, color = &quot;red&quot;) + geom_jitter(height = 0, width = 0.1, 
    shape = 21) + geom_pointrange(data = wt_no_level_coef, aes(x = factor(Colony_number), 
    y = Estimate, ymin = Q2.5, ymax = Q97.5), color = &quot;red&quot;, 
    position = position_nudge(x = -0.1)) + geom_pointrange(data = as_tibble(coef(wt_brm_single_level)$Colony_number, 
    rownames = &quot;Colony_number&quot;), aes(x = factor(Colony_number), 
    y = Estimate.Intercept, ymin = Q2.5.Intercept, ymax = Q97.5.Intercept), 
    position = position_nudge(x = +0.1))</code></pre>
<p><img src="07_23_19_WT_toto1_brms_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The hierarchical model results are in black and dashed gray, and the no hier models are in red. You can see the hierarchy changes the group level estimates slightly - colony 1 and 6 are shifted down / up, colonies 2, 3, and 5 have more confident estimates. However, the hyperparameter estimates are nearly identical. In the end we had a pretty balanced dataset, so the hierarchy had a small but limited effect. However, this was a really interesting exercise that should work well on future data!</p>
<hr />
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.5.2 (2018-12-20)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Mojave 10.14.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mice_3.6.0        lattice_0.20-38   tidybayes_1.1.0  
##  [4] brms_2.9.0        Rcpp_1.0.1        ggridges_0.5.1   
##  [7] kableExtra_1.0.1  knitr_1.23        hms_0.4.2        
## [10] lubridate_1.7.4   viridis_0.5.1     viridisLite_0.3.0
## [13] modelr_0.1.2      broom_0.5.1       cowplot_0.9.4    
## [16] forcats_0.3.0     stringr_1.3.1     dplyr_0.8.1      
## [19] purrr_0.2.5       readr_1.3.1       tidyr_0.8.2      
## [22] tibble_2.1.3      ggplot2_3.2.0     tidyverse_1.2.1  
## 
## loaded via a namespace (and not attached):
##   [1] minqa_1.2.4               colorspace_1.4-0         
##   [3] rsconnect_0.8.13          ggstance_0.3.2           
##   [5] markdown_0.9              base64enc_0.1-3          
##   [7] rstudioapi_0.9.0          rstan_2.18.2             
##   [9] svUnit_0.7-12             DT_0.7                   
##  [11] mvtnorm_1.0-10            xml2_1.2.0               
##  [13] splines_3.5.2             bridgesampling_0.6-0     
##  [15] shinythemes_1.1.2         bayesplot_1.7.0          
##  [17] jsonlite_1.6              nloptr_1.2.1             
##  [19] shiny_1.2.0               compiler_3.5.2           
##  [21] httr_1.4.0                backports_1.1.3          
##  [23] assertthat_0.2.1          Matrix_1.2-15            
##  [25] lazyeval_0.2.1            cli_1.0.1                
##  [27] formatR_1.5               later_0.7.5              
##  [29] htmltools_0.3.6           prettyunits_1.0.2        
##  [31] tools_3.5.2               igraph_1.2.4.1           
##  [33] coda_0.19-2               gtable_0.2.0             
##  [35] glue_1.3.1                reshape2_1.4.3           
##  [37] cellranger_1.1.0          nlme_3.1-140             
##  [39] crosstalk_1.0.0           xfun_0.7                 
##  [41] ps_1.3.0                  lme4_1.1-21              
##  [43] rvest_0.3.2               mime_0.6                 
##  [45] miniUI_0.1.1.1            gtools_3.8.1             
##  [47] pan_1.6                   MASS_7.3-51.1            
##  [49] zoo_1.8-6                 scales_1.0.0             
##  [51] colourpicker_1.0          promises_1.0.1           
##  [53] Brobdingnag_1.2-6         parallel_3.5.2           
##  [55] inline_0.3.15             shinystan_2.5.0          
##  [57] yaml_2.2.0                gridExtra_2.3            
##  [59] loo_2.1.0                 StanHeaders_2.18.1-10    
##  [61] rpart_4.1-13              stringi_1.2.4            
##  [63] highr_0.7                 dygraphs_1.1.1.6         
##  [65] boot_1.3-20               pkgbuild_1.0.3           
##  [67] rlang_0.3.4               pkgconfig_2.0.2          
##  [69] matrixStats_0.54.0        evaluate_0.14            
##  [71] labeling_0.3              rstantools_1.5.1         
##  [73] htmlwidgets_1.3           tidyselect_0.2.5         
##  [75] processx_3.2.1            plyr_1.8.4               
##  [77] magrittr_1.5              R6_2.4.0                 
##  [79] generics_0.0.2            mitml_0.3-7              
##  [81] pillar_1.3.1              haven_2.0.0              
##  [83] withr_2.1.2               xts_0.11-2               
##  [85] nnet_7.3-12               survival_2.43-3          
##  [87] abind_1.4-5               crayon_1.3.4             
##  [89] jomo_2.6-9                arrayhelpers_1.0-20160527
##  [91] rmarkdown_1.13            grid_3.5.2               
##  [93] readxl_1.2.0              callr_3.1.1              
##  [95] threejs_0.3.1             digest_0.6.18            
##  [97] webshot_0.5.1             xtable_1.8-3             
##  [99] httpuv_1.4.5.1            stats4_3.5.2             
## [101] munsell_0.5.0             shinyjs_1.0</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
